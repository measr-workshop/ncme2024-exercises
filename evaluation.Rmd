---
title: "Evaluating DCMs"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

```{r setup, include = FALSE}
library(measr)
library(fs)

taylor_data <- readRDS("data/taylor-data.rds")
taylor_qmatrix <- readRDS("data/taylor-qmatrix.rds")

if (!dir_exists("fits")) dir_create("fits")

# estimate/read LCDM model
taylor_lcdm <- measr_dcm(
  data = taylor_data, qmatrix = taylor_qmatrix,
  resp_id = "album",
  type = "lcdm",
  method = "mcmc", backend = "rstan",
  warmup = 1000, iter = 1500,
  chains = 2, cores = 2,
  file = "fits/taylor-lcdm"
)
```

## Exercise 1

* Calculate the M~2~ statistic for the Taylor LCDM model using `add_fit()`

* Extract the M~2~ statistic. Does the model fit the data?

```{r}
taylor_lcdm <- add_fit(_____, method = _____)

measr_extract(_____, _____)
```

## Exercise 2

* Calculate the raw score PPMC for the Taylor LCDM

* Does the model fit the observed data?

```{r}
taylor_lcdm <- add_fit(_____, method = _____, item_fit = NULL)

measr_extract(_____, _____)
```

## Exercise 3

* Calculate PPMCs for the conditional probabilities and odds ratios for the Taylor model

* What do the results tell us about the model?

```{r}
taylor_lcdm <- add_fit(taylor_lcdm, method = "ppmc",
                       item_fit = _____)

measr_extract(_____, _____)

measr_extract(_____, _____)
```

## Exercise 4

* Estimate a DINA model for the Taylor data

* Add PSIS-LOO and WAIC criteria to both the LCDM and DINA models for the Taylor data

* Use `loo_compare()` to compare the LCDM and DINA models
  * What do the findings tell us?
  * Can you explain the results?

```{r}
# Estimate the DINA model
taylor_dina <- measr_dcm(
  data = taylor_data, qmatrix = taylor_qmatrix,
  resp_id = "album",
  type = _____,
  method = "mcmc", backend = "rstan",
  warmup = 1000, iter = 1500,
  chains = 2, cores = 2,
  file = "fits/taylor-dina"
)

# Add criteria
taylor_lcdm <- _____(taylor_lcdm, _____ = _____)
taylor_dina <- _____(taylor_dina, _____ = _____)

# Compare criteria
loo_compare(_____, _____, criterion = _____)
loo_compare(_____, _____, criterion = _____)
```

## Exercise 5

* Add reliability information to the Taylor LCDM and DINA models

* Examine the attribute classification indices for both models

```{r}
taylor_lcdm <- _____(taylor_lcdm)
taylor_dina <- _____(taylor_dina)

measr_extract(taylor_lcdm, _____)
measr_extract(taylor_dina, _____)
```
